<section class="map">
<%= render partial: "spots_show_top", locals: { spot: @spot } %>

  <div class="tab-content">
    <div class="container col-md-8 mx-auto">
      <div class="row">
        <div class="col-md-8 order-md-2 p-0">
          <% if @spot.latitude.nil? || @spot.longitude.nil? %>
            <div class="pl-3">
              <%= 'マップが登録されていません' %>
            </div>
          <% else %>
            <div id='map'></div>
          <% end %>

          <style>
          #map {
            height: 400px;
            width: 400px;
            margin: 0 auto;
          }
          </style>

          <script>
          let map

          function initMap(){
            geocoder = new google.maps.Geocoder()
            var test ={ lat: <%= @spot.latitude %>, lng: <%= @spot.longitude %> };
            var map = new google.maps.Map(document.getElementById('map'), {
              zoom: 13,
              center: test
            });

            var transitLayer = new google.maps.TransitLayer();
            transitLayer.setMap(map);

            var contentString = "住所：<%= @spot.address %>";
            var infowindow = new google.maps.InfoWindow({
              content: contentString
            });

            var marker = new google.maps.Marker({
              position:test,
              map: map,
              title: contentString
            });

            marker.addListener('click', function() {
              infowindow.open(map, marker);
            });
          }
          </script>
          <script src="https://maps.googleapis.com/maps/api/js?key=<%= ENV['GOOGLE_MAP_API_KEY']%>&callback=initMap" async defer></script>

        </div>
        <div class="col-md-4 order-md-1">
          <%= image_tag @spot.image.url, class: 'img-fluid rounded', alt: 'Responsive image' %>
        </div>
      </div>
    </div>
  </div>
</section>
